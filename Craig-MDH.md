Craig「修正Denavit–Hartenberg（MDH）」記法
以下は、Craigによる「修正DH（MDH）」座標系の厳密な構築ルールと、従来のDH記法との違いです。
1. 基本的な考え方
クラシックDHでは、$x_i$軸を$z_i$と$z_{i+1}$の共通法線に関連付け、変換$T_{i-1}^{i}$を以下の順で構築します：
- $Rot_z(θ_i) → Trans_z(d_i) → Trans_x(a_i) → Rot_x(α_i)$
一方、Craigの修正DHでは、$(a_{i-1}, α_{i-1})$をリンクi−1に、$(θ_i, d_i)$を関節iに関連付け、変換順序が異なります：
- $T_{i-1}^{i} = Rot_x(α_{i-1}) · Trans_x(a_{i-1}) · Rot_z(θ_i) · Trans_z(d_i)$

2. 座標系の割り当てアルゴリズム（修正DH）

i = 0..n（n個の関節）に対して：
- $z_i$軸を選定：関節iの軸（i = 1..n）。$z_0$は基準軸、$z_n$はツールまたはエンドエフェクタの進行方向軸。
- 各$i ≥ 1$に対して、$z_{i-1}$から$z_i$への最短共通法線に沿って$x_{i-1}$を選定：
- $z_{i-1}$と$z_i$が交差する場合：a_{i-1} = 0、$x_{i-1}$は$z_{i-1}$に垂直な平面内の任意方向（右手系を形成する方向）。
- ねじれた場合：一意な共通法線 → その方向が$x_{i-1}$。
- 平行な場合：無限の共通法線 → 一貫性のある選定（退化ケース）。
- 原点$O_{i-1}$は$z_{i-1}$と$x_{i-1}$の交点（または交差する軸なら関節位置）。
- 原点$O_i$は$z_i$が$x_{i-1}$と交差する点（または関節位置）。
- $y_{i-1} = z_{i-1} × x_{i-1}$として右手系を完成。

3. パラメータ定義（修正DH）
上記の方法で構築された座標系(i−1)とiに対して：
- $a_{i-1}$：リンク長 = $x_{i-1}$方向の$z_{i-1}$から$z_i$までの距離。
- $α_{i-1}$：リンクねじれ角 = $x_{i-1}$軸周りに$z_{i-1}$を$z_i$へ回転させる符号付き角度（通常範囲は[−π, π]）。
- $d_i$：関節オフセット = $z_i$方向に$x_{i-1}$との交点から原点$O_i$までの距離（関節iが直動型なら可変）。
- $θ_i$：関節角度 = $z_i$軸周りに$x_{i-1}$から$x_i$への回転角（関節iが回転型なら可変）。

4. 同次変換（修正DH）変換式：
- $T_{i-1}^{i} = Rot_x(α_{i-1}) · Trans_x(a_{i-1}) · Rot_z(θ_i) · Trans_z(d_i)$
展開された4×4行列の積により、最終的な変換行列は：
[  cosθ_i            -sinθ_i             0              a_{i-1}        ]
[  sinθ_i cosα_{i-1}  cosθ_i cosα_{i-1}  -sinα_{i-1}  -sinα_{i-1} d_i ]
[  sinθ_i sinα_{i-1}  cosθ_i sinα_{i-1}   cosα_{i-1}   cosα_{i-1} d_i ]
[       0                   0                   0               1           ]
（掛け算の順序を変えても同じ形になりますが、上記は定義された順序に従っています）

5. 比較まとめ- クラシックDH：$T_{i-1}^{i} = Rot_z(θ_i) Trans_z(d_i) Trans_x(a_i) Rot_x(α_i)$
- 修正DH：$T_{i-1}^{i} = Rot_x(α_{i-1}) Trans_x(a_{i-1}) Rot_z(θ_i) Trans_z(d_i)$
インデックスのずれ：
$(a, α)$は前のリンクに、$(θ, d)$は現在の関節に属する。順序の違いにより、ヤコビアンが簡素化されることがあり、特異なパラメータケースが減ることもある。

6. 特殊／退化ケース
- 軸が交差：$a_{i-1} = 0$
- 軸が平行（同方向）：$α_{i-1} = 0$、一貫した$x_{i-1}$を選定、$a_{i-1}$は最短距離
- 軸が平行（逆方向）：$α_{i-1} = π$（または$−π$）、同様の処理
- 軸が同一直線上：$a_{i-1} = 0$かつ$α_{i-1} = 0$（または$π$）、$x_{i-1}$は任意の垂直方向、連続性を保つよう選定

7. 実用的一貫性ルール- 常に$α$の連続性を保つ（不要なπと−πの切り替えを避ける）
- 軸が平行な場合、決定的な選定基準を設ける（例：前の$x_{i-2}$との角度を最小化するよう$x_{i-1}$を選ぶ）
- 使用する記法を文書化し、外部から提供されるパラメータ表と一致させる

8. C#による補助関数（修正DH変換）

```csharp
using System;
using System.Numerics;

public static class MDH
{
    // 修正DHパラメータ (aPrev, alphaPrev, theta, d) に基づく T_{i-1}^{i} を返す
    public static Matrix4x4 Transform(float aPrev, float alphaPrev, float theta, float d)
    {
        float ca = MathF.Cos(alphaPrev);
        float sa = MathF.Sin(alphaPrev);
        float ct = MathF.Cos(theta);
        float st = MathF.Sin(theta);

        return new Matrix4x4(
            ct,             -st,            0f,         aPrev,
            st * ca,        ct * ca,       -sa,        -sa * d,
            st * sa,        ct * sa,        ca,         ca * d,
            0f,             0f,             0f,         1f
        );
    }
}
```


9. チートシート（修正DH）与えられた$z_i$軸に対して：- x_{i-1}：$z_{i-1}$と$z_i$の共通法線
- a_{i-1}：共通法線の長さ
- α_{i-1}：$x_{i-1}$軸周りの$z_{i-1}$から$z_i$への角度
- θ_i：$z_i$軸周りの$x_{i-1}$から$x_i$への角度（回転関節の場合）
- d_i：$z_i$軸に沿った$x_{i-1}$から原点$O_i$までの距離（直動関節の場合）
- $T_{i-1}^{i} = Rot_x(α_{i-1}) Trans_x(a
